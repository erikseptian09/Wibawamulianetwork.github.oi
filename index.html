<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Pelanggan</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to right, #297ed3, #21578d);
      font-family: 'Segoe UI', sans-serif;
      font-size: 16px;
    }
    .card {
      margin: 4rem auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      border-radius: 1rem;
      overflow-x: auto;
      background-image: url('Wbm4.jpg');
      background-repeat: no-repeat;
      background-size: 100% 100%;
    }
    .card-header {
      background-color: #0d6efd;
      color: white;
      padding: 1rem;
      font-size: 1.25rem;
      font-weight: bold;
    }
    
  .table, .table th, .table td {
    background-color: transparent !important;
    color: #3cff4a;
  }
    table.dataTable tbody tr:hover {
      background-color: rgb(73,123,248);
    }
    .modal-lg {
      max-width: 700px;
    }
    img {
      width: 50px;
      margin-right: 1rem;
    }
.marquee-fixed {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #0d6efd;
      color: white;
      padding: 10px;
      font-weight: bold;
      z-index: 999;
    }
    
    footer {
      font-size:20px;
      background-color: #63636392;
      color:white;
      text-align: center;
      padding: 15px;
    }
  

@media (max-width: 768px) {
  .card {
    margin: 4rem 1rem;
    background-size: cover;
  }
  img {
    width: 40px;
  }
  .card-header {
    font-size: 1rem;
  }
  footer {
    font-size: 16px;
    padding: 10px;
  }
  .modal-lg {
    max-width: 95% !important;
  }
}
.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}
</style>
</head>
<body>
<marquee class="marquee-fixed">
    Selamat Datang Di Data Pelanggan Wibawamulia.Network ( Wbm.Net )
  </marquee>
  <div class="container">
    <div class="card">
      <div class="card-header text-center">
        <img src="wbm1.jpg" alt="wbm1.jpg" />
        <i class="fas fa-users" ></i> Data Pelanggan Wbm.Net
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table id="example1" class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>No</th>
                <th>Nama</th>
                <th>Paket</th>
                <th>Keterangan</th>
                <th>Harga</th>
                <th>Kode Unik</th>
                <th>Total</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
     <hr />
    <div class="card">
  <div class="card-header text-center bg-success">
    <i class="fas fa-check-circle"></i> Pelanggan Lunas
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table id="tableLunas" class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>No</th>
            <th>Nama</th>
            <th>Paket</th>
            <th>Keterangan</th>
            <th>Harga</th>
            <th>Total</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

  </div>  <!-- Modal Edit -->  <div class="modal fade" id="modalEdit" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Edit Data Pelanggan</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="formEdit">
            <input type="hidden" id="editNo">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Nama</label>
                <input type="text" class="form-control" id="editNama">
              </div>
              <div class="col-md-6">
                <label class="form-label">Paket</label>
                <input type="text" class="form-control" id="editPaket">
              </div>
              <div class="col-md-6">
                <label class="form-label">Keterangan</label>
                <input type="text" class="form-control" id="editKet">
              </div>
              <div class="col-md-6">
                <label class="form-label">Harga</label>
                <input type="text" class="form-control" id="editHarga">
              </div>
              <div class="col-md-6">
                <label class="form-label">Kode Unik</label>
                <input type="text" class="form-control" id="editUnik">
              </div>
            </div>
            <div class="mt-3 text-end">
              <button type="submit" class="btn btn-primary">Simpan</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <footer>
    Â©Wbm.Net2020.com
  </footer>
  
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>  <script>
    let dataGlobal = [];

    $(document).ready(function () {
      // Hapus otomatis data lunas yang lewat 30 hari
      let dataLunas = JSON.parse(localStorage.getItem('pelanggan_lunas') || '[]');
      const today = new Date();
      dataLunas = dataLunas.filter(p => {
        const tgl = new Date(p.tanggal_lunas);
        const beda = (today - tgl) / (1000 * 60 * 60 * 24);
        return beda < 30;
      });
      localStorage.setItem('pelanggan_lunas', JSON.stringify(dataLunas));
      dataLunas.forEach(p => {
        $('#tableLunas tbody').append(`
          <tr id="lunas-${p.no}">
            <td>${p.no}</td>
            <td>${p.nama}</td>
            <td>${p.paket}</td>
            <td>${p.keterangan}</td>
            <td>${p.harga}</td>
            <td>${p.total}</td>
            <td class="text-center">
              <button class='btn btn-sm btn-warning' onclick='kembalikanData(${p.no})'><i class='fas fa-undo'></i></button>
            </td>
          </tr>`);
      });

      fetch("data_paket.json")
        .then(res => res.json())
        .then(data => {
          dataGlobal = data;
          data.forEach(p => {
            if (!dataLunas.find(l => l.no == p.No)) {
              const aksi = `
                <button class='btn btn-sm btn-primary me-1' onclick='showEdit(${p.No})'><i class='fas fa-edit'></i></button>
                <button class='btn btn-sm btn-danger me-1' onclick='hapusData(${p.No})'><i class='fas fa-trash'></i></button>
                <button class='btn btn-sm btn-success' onclick='bayarData(${p.No})'><i class='fas fa-money-bill-wave'></i></button>
              `;
              $('#example1 tbody').append(`
                <tr id="row-${p.No}">
                  <td>${p.No}</td>
                  <td>${p.Nama_Pelanggan}</td>
                  <td>${p.Paket}</td>
                  <td>${p.Keterangan}</td>
                  <td>${p.Harga}</td>
                  <td>${p.Kode_Unik}</td>
                  <td>${p.Total_Bayar}</td>
                  <td class="text-center">${aksi}</td>
                </tr>
              `);
            }
          });
          $('#example1').DataTable({ scrollX: true });
        });
      $('#formEdit').on('submit', function (e) {
        e.preventDefault();
        const no = $('#editNo').val();
        const row = $(`#row-${no}`);
        row.find('td').eq(1).text($('#editNama').val());
        row.find('td').eq(2).text($('#editPaket').val());
        row.find('td').eq(3).text($('#editKet').val());
        row.find('td').eq(4).text($('#editHarga').val());
        row.find('td').eq(5).text($('#editUnik').val());
        const total = parseInt($('#editHarga').val().replace(/\D/g, '')) + parseInt($('#editUnik').val());
        row.find('td').eq(6).text(total);
        $('#modalEdit').modal('hide');
      });
    });

    function showEdit(no) {
      const p = dataGlobal.find(d => d.No == no);
      $('#editNo').val(p.No);
      $('#editNama').val(p.Nama_Pelanggan);
      $('#editPaket').val(p.Paket);
      $('#editKet').val(p.Keterangan);
      $('#editHarga').val(p.Harga);
      $('#editUnik').val(p.Kode_Unik);
      $('#modalEdit').modal('show');
    }

    function hapusData(no) {
      if (confirm('Yakin hapus pelanggan No ' + no + '?')) {
        $(`#row-${no}`).remove();
      }
    }

    function bayarData(no) {
      const row = $(`#row-${no}`);
      const data = row.children().map((_, td) => $(td).text()).get();
      const pelanggan = {
        no: data[0], nama: data[1], paket: data[2], keterangan: data[3], harga: data[4], total: data[6], tanggal_lunas: new Date().toISOString()
      };
      let lunas = JSON.parse(localStorage.getItem('pelanggan_lunas') || '[]');
      lunas.push(pelanggan);
      localStorage.setItem('pelanggan_lunas', JSON.stringify(lunas));
      alert(`Pelanggan ${pelanggan.nama} sudah melakukan pembayaran.`);

      $('#tableLunas tbody').append(`
        <tr id="lunas-${pelanggan.no}">
          <td>${pelanggan.no}</td>
          <td>${pelanggan.nama}</td>
          <td>${pelanggan.paket}</td>
          <td>${pelanggan.keterangan}</td>
          <td>${pelanggan.harga}</td>
          <td>${pelanggan.total}</td>
          <td class="text-center">
            <button class='btn btn-sm btn-warning' onclick='kembalikanData(${pelanggan.no})'><i class='fas fa-undo'></i></button>
          </td>
        </tr>`);

      row.remove();
    }

    function kembalikanData(no) {
      let lunas = JSON.parse(localStorage.getItem('pelanggan_lunas') || '[]');
      const p = lunas.find(x => x.no == no);
      lunas = lunas.filter(x => x.no != no);
      localStorage.setItem('pelanggan_lunas', JSON.stringify(lunas));

      const aksi = `
        <button class='btn btn-sm btn-primary me-1' onclick='showEdit(${p.no})'><i class='fas fa-edit'></i></button>
        <button class='btn btn-sm btn-danger me-1' onclick='hapusData(${p.no})'><i class='fas fa-trash'></i></button>
        <button class='btn btn-sm btn-success' onclick='bayarData(${p.no})'><i class='fas fa-money-bill-wave'></i></button>
      `;

      $('#example1 tbody').append(`
        <tr id="row-${p.no}">
          <td>${p.no}</td>
          <td>${p.nama}</td>
          <td>${p.paket}</td>
          <td>${p.keterangan}</td>
          <td>${p.harga}</td>
          <td>-</td>
          <td>${p.total}</td>
          <td class="text-center">${aksi}</td>
        </tr>`);

      $(`#lunas-${no}`).remove();
    }
  </script></body>
</html>
